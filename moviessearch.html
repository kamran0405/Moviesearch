<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Movie Search Hub</title>
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Space Grotesk', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
    .scrollbar-hidden::-webkit-scrollbar { display: none; }
    .scrollbar-hidden { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body class="bg-slate-950 text-white min-h-screen">
  <div id="root" class="min-h-screen"></div>

  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const IMAGE_BASE = 'https://image.tmdb.org/t/p/w500';

    const EmptyState = ({ title, description }) => (
      <div className="flex flex-col items-center justify-center text-center px-6 py-12 border border-dashed border-white/20 rounded-3xl bg-white/5">
        <h3 className="text-xl font-semibold">{title}</h3>
        <p className="text-white/70 mt-2 max-w-md">{description}</p>
      </div>
    );

    const MovieCard = ({ movie, onSelect, onToggleFavorite, isFavorite }) => {
      const poster = movie.poster_path ? `${IMAGE_BASE}${movie.poster_path}` : 'https://placehold.co/500x750?text=No+Poster';
      return (
        <div className="group bg-white/5 rounded-3xl border border-white/10 overflow-hidden backdrop-blur">
          <div className="relative">
            <img src={poster} alt={movie.title} className="w-full h-80 object-cover" />
            <button
              onClick={() => onToggleFavorite(movie)}
              className={`absolute top-4 right-4 rounded-full p-2 transition ${isFavorite ? 'bg-pink-500 text-white' : 'bg-white/80 text-slate-900'}`}
            >
              {isFavorite ? '♥' : '♡'}
            </button>
          </div>
          <div className="p-5 flex flex-col gap-3">
            <div>
              <p className="text-xs uppercase tracking-[0.3em] text-pink-400">{movie.release_date ? movie.release_date.split('-')[0] : 'TBA'}</p>
              <h3 className="text-lg font-semibold leading-tight">{movie.title}</h3>
              <p className="text-sm text-white/70 line-clamp-2">{movie.overview || 'No synopsis available.'}</p>
            </div>
            <div className="flex items-center justify-between text-sm text-white/70">
              <span>⭐ {movie.vote_average ? movie.vote_average.toFixed(1) : 'NR'}</span>
              <button
                onClick={() => onSelect(movie.id)}
                className="px-4 py-1.5 rounded-full text-sm font-medium bg-white/10 border border-white/20 hover:bg-white/20"
              >
                Details
              </button>
            </div>
          </div>
        </div>
      );
    };

    const FavoritesRail = ({ favorites, onSelect, onToggleFavorite }) => (
      <div className="mt-10">
        <div className="flex items-center justify-between mb-4">
          <h2 className="text-2xl font-semibold">Favorites</h2>
          <p className="text-white/60 text-sm">{favorites.length} saved</p>
        </div>
        {favorites.length === 0 ? (
          <EmptyState
            title="No favorite movies yet"
            description="Mark movies as favorites to keep them handy. They are synced to your browser storage so they persist between visits."
          />
        ) : (
          <div className="flex gap-4 overflow-x-auto scrollbar-hidden pb-2">
            {favorites.map(movie => (
              <div key={movie.id} className="min-w-[200px] bg-white/5 rounded-3xl border border-white/10 overflow-hidden">
                <img src={movie.poster_path ? `${IMAGE_BASE}${movie.poster_path}` : 'https://placehold.co/400x600?text=No+Poster'} alt={movie.title} className="w-full h-60 object-cover" />
                <div className="p-4">
                  <p className="text-xs uppercase tracking-[0.3em] text-pink-400">{movie.release_date ? movie.release_date.split('-')[0] : 'TBA'}</p>
                  <h4 className="font-semibold">{movie.title}</h4>
                  <div className="flex items-center justify-between mt-3 text-sm">
                    <button onClick={() => onSelect(movie.id)} className="text-white/70 hover:text-white">Details</button>
                    <button onClick={() => onToggleFavorite(movie)} className="text-pink-400 hover:text-pink-300">Remove</button>
                  </div>
                </div>
              </div>
            ))}
          </div>
        )}
      </div>
    );

    const Modal = ({ movie, onClose }) => {
      if (!movie) return null;
      const poster = movie.poster_path ? `${IMAGE_BASE}${movie.poster_path}` : 'https://placehold.co/600x900?text=No+Poster';
      return (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center px-6 py-10">
          <div className="bg-slate-900 rounded-[32px] max-w-4xl w-full overflow-hidden border border-white/10 shadow-2xl">
            <div className="flex flex-col md:flex-row">
              <div className="md:w-1/3">
                <img src={poster} alt={movie.title} className="w-full h-full object-cover" />
              </div>
              <div className="md:w-2/3 p-8 space-y-6">
                <div className="flex items-start justify-between gap-4">
                  <div>
                    <p className="text-xs uppercase tracking-[0.3em] text-pink-400">TMDB • Score {movie.vote_average?.toFixed(1) || 'NR'}</p>
                    <h3 className="text-3xl font-semibold">{movie.title}</h3>
                    <p className="text-white/70">{movie.tagline}</p>
                  </div>
                  <button onClick={onClose} className="text-white/70 hover:text-white text-2xl">×</button>
                </div>
                <p className="text-white/80 leading-relaxed">{movie.overview || 'No synopsis available.'}</p>
                <div className="grid grid-cols-2 gap-4 text-sm">
                  <div>
                    <p className="text-white/50">Runtime</p>
                    <p className="font-semibold">{movie.runtime ? `${movie.runtime} min` : 'N/A'}</p>
                  </div>
                  <div>
                    <p className="text-white/50">Release</p>
                    <p className="font-semibold">{movie.release_date || 'TBA'}</p>
                  </div>
                  <div>
                    <p className="text-white/50">Genres</p>
                    <p className="font-semibold">{movie.genres?.map(g => g.name).join(', ') || '—'}</p>
                  </div>
                  <div>
                    <p className="text-white/50">Language</p>
                    <p className="font-semibold">{movie.original_language?.toUpperCase() || 'N/A'}</p>
                  </div>
                </div>
                {movie.videos?.results?.length > 0 && (
                  <div className="space-y-2">
                    <p className="text-white/50 text-sm uppercase tracking-[0.3em]">Videos</p>
                    <div className="flex flex-wrap gap-2">
                      {movie.videos.results.slice(0, 3).map(video => (
                        <a
                          key={video.id}
                          href={`https://www.youtube.com/watch?v=${video.key}`}
                          target="_blank"
                          rel="noreferrer"
                          className="px-4 py-2 rounded-full border border-white/20 hover:bg-white/10 text-sm"
                        >
                          {video.type}
                        </a>
                      ))}
                    </div>
                  </div>
                )}
              </div>
            </div>
          </div>
        </div>
      );
    };

    const App = () => {
      const [apiKey, setApiKey] = React.useState(() => localStorage.getItem('tmdb_api_key') || '');
      const [apiKeyInput, setApiKeyInput] = React.useState(() => localStorage.getItem('tmdb_api_key') || '');
      const [query, setQuery] = React.useState('');
      const [selectedGenre, setSelectedGenre] = React.useState('');
      const [year, setYear] = React.useState('');
      const [page, setPage] = React.useState(1);
      const [totalPages, setTotalPages] = React.useState(0);
      const [movies, setMovies] = React.useState([]);
      const [genres, setGenres] = React.useState([]);
      const [favorites, setFavorites] = React.useState(() => {
        try {
          return JSON.parse(localStorage.getItem('tmdb_favorites')) || [];
        } catch {
          return [];
        }
      });
      const [lastSearch, setLastSearch] = React.useState({ query: '', genre: '', year: '' });
      const [loading, setLoading] = React.useState(false);
      const [error, setError] = React.useState('');
      const [selectedMovie, setSelectedMovie] = React.useState(null);
      const [isModalOpen, setIsModalOpen] = React.useState(false);

      React.useEffect(() => {
        localStorage.setItem('tmdb_favorites', JSON.stringify(favorites));
      }, [favorites]);

      React.useEffect(() => {
        if (apiKey) {
          localStorage.setItem('tmdb_api_key', apiKey);
          fetchGenres(apiKey);
        }
      }, [apiKey]);

      const fetchGenres = async (key) => {
        try {
          const res = await fetch(`https://api.themoviedb.org/3/genre/movie/list?api_key=${key}&language=en-US`);
          const data = await res.json();
          if (data.genres) setGenres(data.genres);
        } catch (err) {
          console.error(err);
        }
      };

      const fetchMovies = async (pageToFetch, params) => {
        if (!apiKey) {
          setError('Add your TMDB API key to start searching.');
          return;
        }
        setLoading(true);
        setError('');
        try {
          const searchParams = new URLSearchParams({
            api_key: apiKey,
            query: params.query,
            include_adult: 'false',
            language: 'en-US',
            page: pageToFetch,
          });
          if (params.year) searchParams.append('year', params.year);
          const response = await fetch(`https://api.themoviedb.org/3/search/movie?${searchParams.toString()}`);
          const data = await response.json();
          if (data.success === false) {
            throw new Error(data.status_message || 'Failed to fetch movies.');
          }
          let results = data.results || [];
          if (params.genre) {
            results = results.filter(movie => movie.genre_ids?.includes(Number(params.genre)));
          }
          if (params.year) {
            results = results.filter(movie => movie.release_date?.startsWith(params.year));
          }
          setMovies(results);
          setTotalPages(data.total_pages || 1);
          setPage(pageToFetch);
        } catch (err) {
          setError(err.message || 'Something went wrong fetching movies.');
        } finally {
          setLoading(false);
        }
      };

      const handleSearch = () => {
        if (!query.trim()) {
          setError('Type a movie title to search.');
          return;
        }
        const params = { query: query.trim(), genre: selectedGenre, year };
        setLastSearch(params);
        fetchMovies(1, params);
      };

      const handlePageChange = (direction) => {
        const newPage = page + direction;
        if (newPage < 1 || newPage > totalPages) return;
        fetchMovies(newPage, lastSearch);
      };

      const handleToggleFavorite = (movie) => {
        setFavorites(prev => {
          const exists = prev.some(item => item.id === movie.id);
          if (exists) {
            return prev.filter(item => item.id !== movie.id);
          }
          const liteMovie = {
            id: movie.id,
            title: movie.title,
            poster_path: movie.poster_path,
            release_date: movie.release_date,
          };
          return [liteMovie, ...prev];
        });
      };

      const openDetails = async (movieId) => {
        if (!apiKey) return;
        setIsModalOpen(true);
        setSelectedMovie(null);
        try {
          const res = await fetch(`https://api.themoviedb.org/3/movie/${movieId}?api_key=${apiKey}&append_to_response=videos`);
          const data = await res.json();
          setSelectedMovie(data);
        } catch (err) {
          console.error(err);
        }
      };

      const closeModal = () => {
        setIsModalOpen(false);
        setSelectedMovie(null);
      };

      const isFavorite = (id) => favorites.some(movie => movie.id === id);

      return (
        <div className="max-w-6xl mx-auto px-6 py-12">
          <header className="space-y-4 text-center">
            <p className="text-xs uppercase tracking-[0.75em] text-pink-400">React • TMDB • Hooks</p>
            <h1 className="text-4xl sm:text-5xl font-bold">Movie Search Playground</h1>
            <p className="text-white/70 max-w-3xl mx-auto">
              Search TMDB's vast catalog, dive into detailed breakdowns, curate your favorites, and filter by genre or release year — all powered by React hooks and Tailwind.
            </p>
          </header>

          <section className="mt-10 grid gap-6 bg-white/5 border border-white/10 rounded-[32px] p-6">
            <div className="grid gap-3">
              <label className="text-sm text-white/60">TMDB API Key</label>
              <div className="flex flex-col md:flex-row gap-4">
                <input
                  type="password"
                  className="flex-1 bg-white/10 border border-white/20 rounded-2xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-pink-400"
                  placeholder="Paste your TMDB v3 API key"
                  value={apiKeyInput}
                  onChange={(e) => setApiKeyInput(e.target.value)}
                />
                <button
                  onClick={() => setApiKey(apiKeyInput.trim())}
                  className="px-6 py-3 rounded-2xl bg-pink-500 hover:bg-pink-400 font-semibold"
                >
                  Save Key
                </button>
              </div>
              {!apiKey && (
                <p className="text-xs text-white/60">Get a free key at <a className="text-pink-400 underline" href="https://www.themoviedb.org/signup" target="_blank" rel="noreferrer">themoviedb.org</a>. The key stays in your browser only.</p>
              )}
            </div>

            <div className="grid lg:grid-cols-12 gap-4 items-end">
              <div className="lg:col-span-5">
                <label className="text-sm text-white/60">Movie Title</label>
                <input
                  type="text"
                  className="w-full bg-white/10 border border-white/20 rounded-2xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-pink-400"
                  placeholder="Search by title (e.g., Oppenheimer)"
                  value={query}
                  onChange={(e) => setQuery(e.target.value)}
                  onKeyDown={(e) => e.key === 'Enter' && handleSearch()}
                />
              </div>
              <div className="lg:col-span-3">
                <label className="text-sm text-white/60">Genre</label>
                <select
                  className="w-full bg-white/10 border border-white/20 rounded-2xl px-4 py-3"
                  value={selectedGenre}
                  onChange={(e) => setSelectedGenre(e.target.value)}
                >
                  <option value="">All genres</option>
                  {genres.map(genre => (
                    <option key={genre.id} value={genre.id}>{genre.name}</option>
                  ))}
                </select>
              </div>
              <div className="lg:col-span-2">
                <label className="text-sm text-white/60">Year</label>
                <input
                  type="number"
                  min="1900"
                  max={new Date().getFullYear()}
                  className="w-full bg-white/10 border border-white/20 rounded-2xl px-4 py-3"
                  placeholder="2023"
                  value={year}
                  onChange={(e) => setYear(e.target.value)}
                />
              </div>
              <div className="lg:col-span-2 flex">
                <button
                  onClick={handleSearch}
                  className="w-full bg-pink-500 hover:bg-pink-400 rounded-2xl px-6 py-3 font-semibold"
                >
                  Search
                </button>
              </div>
            </div>
            {error && <p className="text-sm text-pink-300">{error}</p>}
          </section>

          <section className="mt-12">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-xs uppercase tracking-[0.5em] text-pink-400">Results</p>
                <h2 className="text-3xl font-semibold">Movie Grid</h2>
              </div>
              <div className="flex items-center gap-3">
                <button
                  onClick={() => handlePageChange(-1)}
                  disabled={page <= 1}
                  className={`px-4 py-2 rounded-full border border-white/20 ${page <= 1 ? 'text-white/30 border-white/10' : 'hover:bg-white/10'}`}
                >
                  Prev
                </button>
                <span className="text-white/70 text-sm">Page {page} / {Math.max(totalPages, 1)}</span>
                <button
                  onClick={() => handlePageChange(1)}
                  disabled={page >= totalPages}
                  className={`px-4 py-2 rounded-full border border-white/20 ${page >= totalPages ? 'text-white/30 border-white/10' : 'hover:bg-white/10'}`}
                >
                  Next
                </button>
              </div>
            </div>

            {loading ? (
              <div className="flex justify-center items-center py-20">
                <div className="w-16 h-16 border-4 border-white/20 border-t-pink-500 rounded-full animate-spin"></div>
              </div>
            ) : movies.length === 0 ? (
              <div className="mt-8">
                <EmptyState
                  title="No movies yet"
                  description="Run a search to see results here. Use the filters to refine by genre and year, then dive into details and save your favorites."
                />
              </div>
            ) : (
              <div className="mt-8 grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
                {movies.map(movie => (
                  <MovieCard
                    key={movie.id}
                    movie={movie}
                    onSelect={openDetails}
                    onToggleFavorite={handleToggleFavorite}
                    isFavorite={isFavorite(movie.id)}
                  />
                ))}
              </div>
            )}
          </section>

          <FavoritesRail
            favorites={favorites}
            onSelect={openDetails}
            onToggleFavorite={handleToggleFavorite}
          />

          {isModalOpen && (
            <Modal movie={selectedMovie} onClose={closeModal} />
          )}
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>